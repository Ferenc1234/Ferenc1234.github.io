<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="form-container"></div>
</body>


<script>
  async function loadForm() {
    const res = await fetch('https://hidden-term-c0fc.frubacek.workers.dev/');
    const fields = await res.json();

    const container = document.getElementById('form-container');
    const form = document.createElement('form');
    form.id = 'dynamic-form';

    // Create an element for showing errors
    const errorsDiv = document.createElement('div');
    errorsDiv.style.color = 'red';
    errorsDiv.style.marginTop = '1rem';

    // Create an element for success message
    const successDiv = document.createElement('div');
    successDiv.style.color = 'lightgreen';
    successDiv.style.marginTop = '1rem';

    fields.forEach(field => {
      const label = document.createElement('label');

      label.innerHTML = field.label + (field.required ? ' <span style="color:red">*</span>' : '') + ':';

      let input;
      if (field.type === 'textarea') {
        input = document.createElement('textarea');
      } else {
        input = document.createElement('input');
        input.type = field.type;
      }

      input.name = field.name;
      if (field.required) input.required = true;

      label.appendChild(document.createElement('br'));
      label.appendChild(input);
      form.appendChild(label);
      form.appendChild(document.createElement('br'));
    });

    const submitBtn = document.createElement('button');
    submitBtn.type = 'submit';
    submitBtn.textContent = 'Send';
    form.appendChild(submitBtn);

    container.appendChild(form);
    container.appendChild(errorsDiv);
    container.appendChild(successDiv);

    form.addEventListener('submit', async e => {
      e.preventDefault();
      errorsDiv.textContent = '';
      successDiv.textContent = '';

      const formData = new FormData(form);

      // Client-side validation
      let errors = [];

      // Check required fields manually to customize messages
      fields.forEach(field => {
        if (field.required) {
          const val = formData.get(field.name);
          if (!val || (field.type === 'file' && val.size === 0)) {
            errors.push(`${field.label} is required.`);
          } else if (field.type === 'email' && val) {
            // Simple email format check
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(val)) {
              errors.push('Please enter a valid email address.');
            }
          }
        }
      });

      if (errors.length > 0) {
        errorsDiv.innerHTML = errors.map(e => `<div>${e}</div>`).join('');
        return;
      }

      try {
        const res = await fetch('https://hidden-term-c0fc.frubacek.workers.dev/', {
          method: 'POST',
          body: formData
        });

        const result = await res.json();

        if (result.success) {
          successDiv.textContent = result.message;
          form.reset();
        } else {
          errorsDiv.textContent = result.message || 'Unknown error.';
          console.error('Email sending error:', result.error);
        }
      } catch (err) {
        errorsDiv.textContent = 'Network or server error: ' + err.message;
      }
    });
  }

  loadForm();
</script>
