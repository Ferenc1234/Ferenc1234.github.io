<div id="form-container"></div>

<script>
  async function loadForm() {
    const res = await fetch('https://hidden-term-c0fc.frubacek.workers.dev/');
    const fields = await res.json();

    const container = document.getElementById('form-container');
    const form = document.createElement('form');
    form.id = 'dynamic-form';

    fields.forEach(field => {
      const label = document.createElement('label');
      label.textContent = field.label + ': ';

      let input;
      if (field.type === 'textarea') {
        input = document.createElement('textarea');
      } else {
        input = document.createElement('input');
        input.type = field.type;
      }

      input.name = field.name;
      if (field.required) input.required = true;

      label.appendChild(input);
      container.appendChild(label);
      container.appendChild(document.createElement('br'));
    });

    const submitBtn = document.createElement('button');
    submitBtn.type = 'submit';
    submitBtn.textContent = 'Send';
    form.appendChild(submitBtn);

    container.appendChild(form);

    form.addEventListener('submit', async e => {
  e.preventDefault();
  const data = {};
  new FormData(form).forEach((value, key) => data[key] = value);

  const res = await fetch('https://hidden-term-c0fc.frubacek.workers.dev/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });

  const result = await res.json();

  if (result.success) {
    alert(result.message);
    form.reset();
  } else {
    alert(result.message + ". See console for details.");
    console.error("Email sending error:", result.error);
  }
});

  }

  loadForm();
</script>
